<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NBXBXNE1QV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-NBXBXNE1QV');
  </script>

  <meta charset="UTF-8" />
  <title>AdversaPixels</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="AdversaPixels — Adversarial Pixel Perturbation and Image Distortion Lab">

  <link rel="icon" type="image/png" href="/assets/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="shortcut icon" href="/assets/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="manifest" href="/assets/site.webmanifest">

<style>
/* ===== GLOBAL RESET ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, Helvetica, sans-serif;
}

/* ===== LANDING SECTION ===== */
body {
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #ffffff;
  overflow-x: hidden;
}

.landing {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  position: relative;
}

.site-logo {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 220px;
  filter: drop-shadow(0 0 12px rgba(255, 183, 3, 0.35));
  z-index: 1000;
}

.container {
  max-width: 900px;
  width: 90%;
  padding: 40px;
}

h1 {
  font-size: 42px;
  margin-bottom: 20px;
  line-height: 1.2;
}

h1 span { color: #ffb703; }

p {
  font-size: 18px;
  opacity: 0.9;
  margin-bottom: 40px;
  line-height: 1.6;
}

.footer-note {
  margin-top: 40px;
  font-size: 14px;
  opacity: 0.7;
}

/* ===== SCROLL ARROW ===== */
.scroll-indicator {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  backdrop-filter: blur(10px);
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  animation: bounce 1.5s infinite;
  transition: opacity 1s ease, transform 1.5s ease;
  cursor: pointer;
}

.scroll-indicator::before {
  content: "⇩";
  font-size: 34px;
  color: #ffb703;
}

@keyframes bounce {
  0%,100% { transform: translate(-50%,0); }
  50% { transform: translate(-50%,-10px); }
}

.scroll-indicator.fade-away {
  opacity: 0;
  transform: translate(180px,-60px) rotate(40deg);
  pointer-events: none;
}

/* ===== APP SECTION ===== */
.app-section {
  padding: 80px 20px;
  background: #0f172a;
  min-height: 100vh; 
  display: flex;
  flex-direction: column;
  justify-content: center; 

}

.app-shell {
  max-width:1200px;
  margin:0 auto;
  text-align:center;
  color:#e5e7eb;
}

h2 { margin-bottom: 30px;}

input, button {
  padding:10px 20px;
  font-size:16px;
  border-radius:6px;
  border:none;
  background-color:#3b82f6;
  color:white;
  cursor:pointer;
}

button:hover { background-color:#2563eb;}
button:disabled { opacity:0.5; cursor:not-allowed;}

canvas {
  border:2px solid #38bdf8;
  display:block;
  margin:10px auto;
}

.image-container {
  margin-top:20px;
  border:1px solid #3b82f6;
  padding:10px;
  display:inline-block;
}

.seediff-container {
  display:flex;
  justify-content:center;
  gap:50px;
  margin-top:10px;
  flex-wrap:wrap;
}

.seediff-box { text-align:center;}
.label { font-size:14px; margin-top:5px; color:#e5e7eb;}
.pixel-grid { display:flex; flex-wrap:wrap; justify-content:center;}
.pixel-item { margin:5px; text-align:center;}
.center-btn { display:block; margin:10px auto;}
.progress { font-size:12px; color:#a5b4fc; margin-top:5px;}

.workspace-note {
  max-width:700px;
  margin:0 auto 30px;
  font-size:14px;
  color:#c7d2fe;
  line-height:1.6;
}
</style>
</head>

<body>

<!-- LOGO -->
<img src="assets/logo.png" alt="AdversaPixels logo" class="site-logo">

<!-- ===== LANDING ===== -->
<section class="landing">
  <div class="container">
    <h1>
      MAKE IMAGES <span>HARDER</span> FOR<br>
      AI <span>TO INTERPRET</span>
    </h1>

    <p>
      Upload your image, and our algorithm subtly alters pixel-level structures to
      reduce the reliability of AI-based analysis, while preserving visual clarity
      for human perception.
    </p>

    <!-- Downward Scroll Arrow -->
    <div class="scroll-indicator" id="scrollArrow" onclick="document.getElementById('app').scrollIntoView({behavior:'smooth'})"></div>

    <div class="footer-note">
      No uploads are stored • Privacy-first design
    </div>
  </div>
</section>

<!-- ===== APP SECTION ===== -->
<section class="app-section" id="app">
  <div class="app-shell">

    <h2>Adversarial Pixel Perturbation</h2>

    <div class="workspace-note">
      Upload one or more images and generate controlled pixel perturbations.
      These distortions introduce instability for automated vision systems,
      while remaining difficult to detect through human visual perception.
    </div>

    <input type="file" id="upload" accept="image/*" multiple />
    <div id="allImages"></div>

  </div>
</section>
<script>
/* Scroll arrow fade-away */
const arrow = document.getElementById("scrollArrow");
window.addEventListener("scroll", () => {
  const scrolled = window.scrollY / document.body.scrollHeight;
  if (scrolled > 0.25) arrow.classList.add("fade-away");
});

/* ===== IMAGE PERTURBATION SCRIPT ===== */
const upload = document.getElementById("upload");
const allImages = document.getElementById("allImages");

const MAX_SIZE = 800;
let seed = Math.floor(Math.random() * 1000000);

function seededRandom() { let x = Math.sin(seed++) * 10000; return x - Math.floor(x); }
function clamp(v) { return Math.max(0, Math.min(255, v)); }

upload.addEventListener("change", e => {
  const files = e.target.files;
  allImages.innerHTML = '';

  Array.from(files).forEach((file, idx) => {
    const img = new Image();
    img.onload = () => {
      const scale = Math.min(MAX_SIZE / img.width, MAX_SIZE / img.height, 1);
      const w = Math.round(img.width * scale);
      const h = Math.round(img.height * scale);

      const container = document.createElement("div");
      container.className = "image-container";

      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, w, h);

      const originalData = ctx.getImageData(0, 0, w, h);
      let distortedData = ctx.createImageData(w, h);

      const progressText = document.createElement("div");
      progressText.className = "progress";

      const generateBtn = document.createElement("button");
      generateBtn.textContent = "Generate Distorted Image";

      const downloadBtn = document.createElement("button");
      downloadBtn.textContent = "Download Distorted Image";
      downloadBtn.disabled = true;

      // Create Show Difference button
      const seeDiffBtn = document.createElement("button");
      seeDiffBtn.textContent = "Show Difference";
      seeDiffBtn.disabled = true;
      seeDiffBtn.className = "center-btn";

      // Create the container for pixel grids
      const diffContainer = document.createElement("div");
      diffContainer.className = "diff-container";
      diffContainer.style.display = "none";
      diffContainer.style.gap = "40px";

      const origPixelGrid = document.createElement("div");
      origPixelGrid.className = "pixel-grid";
      origPixelGrid.style.border = "1px solid #38bdf8";
      origPixelGrid.style.padding = "10px";
      origPixelGrid.style.minWidth = "150px";

      const distPixelGrid = document.createElement("div");
      distPixelGrid.className = "pixel-grid";
      distPixelGrid.style.border = "1px solid #f87171";
      distPixelGrid.style.padding = "10px";
      distPixelGrid.style.minWidth = "150px";

      diffContainer.append(origPixelGrid, distPixelGrid);

      // Click handler for Show Difference
      seeDiffBtn.addEventListener("click", () => {
        origPixelGrid.innerHTML = '<strong>Original Pixels</strong><br>';
        distPixelGrid.innerHTML = '<strong>Distorted Pixels</strong><br>';

        const totalPixels = w * h;
        const picks = [];
        while (picks.length < 5) {
          const r = Math.floor(Math.random() * totalPixels);
          if (!picks.includes(r)) picks.push(r);
        }

        picks.forEach(pixelIndex => {
          const i = pixelIndex * 4;

          const oItem = document.createElement("div");
          oItem.className = "pixel-item";
          oItem.innerHTML = `Pixel ${pixelIndex}<br>R=${originalData.data[i]} G=${originalData.data[i + 1]} B=${originalData.data[i + 2]}`;
          origPixelGrid.appendChild(oItem);

          const dItem = document.createElement("div");
          dItem.className = "pixel-item";
          dItem.innerHTML = `Pixel ${pixelIndex}<br>R=${distortedData.data[i]} G=${distortedData.data[i + 1]} B=${distortedData.data[i + 2]}`;
          distPixelGrid.appendChild(dItem);
        });

        diffContainer.style.display = "flex"; // show container
      });

      // Generate distorted image
      generateBtn.addEventListener("click", () => {
        generateBtn.disabled = true;

        const totalPixels = w * h;
        const indices = Array.from({ length: totalPixels }, (_, i) => i).sort(() => Math.random() - 0.5);
        let processed = 0;

        function batch() {
          const batchSize = Math.ceil(totalPixels / 2400);
          for (let n = 0; n < batchSize && processed < totalPixels; n++, processed++) {
            const p = indices[processed] * 4;
            distortedData.data[p]     = clamp(originalData.data[p]     + Math.floor(seededRandom() * 7 - 3));
            distortedData.data[p + 1] = clamp(originalData.data[p + 1] + Math.floor(seededRandom() * 7 - 3));
            distortedData.data[p + 2] = clamp(originalData.data[p + 2] + Math.floor(seededRandom() * 7 - 3));
            distortedData.data[p + 3] = 255;
          }
          ctx.putImageData(distortedData, 0, 0);
          progressText.textContent = `Generating… ${Math.floor((processed / totalPixels) * 100)}%`;
          if (processed < totalPixels) requestAnimationFrame(batch);
          else {
            progressText.textContent = "Completed ✔";
            downloadBtn.disabled = false;
            seeDiffBtn.disabled = false; 
          }
        }

        batch();
      });
    downloadBtn.onclick = () => {
        const link = document.createElement("a");
        link.download = "distorted_" + idx + ".png";
        link.href = canvas.toDataURL();
        link.click();
      };

      generateBtn.className = "center-btn";
      downloadBtn.className = "center-btn";
      seeDiffBtn.className = "center-btn";

      container.append(canvas, progressText, generateBtn, downloadBtn, seeDiffBtn, diffContainer);
      allImages.appendChild(container);
    };
    img.src = URL.createObjectURL(file);
  });
});
</script>
</body>
</html>
