<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NBXBXNE1QV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NBXBXNE1QV');
</script>
<meta charset="UTF-8">
<title> AdversaPixels </title>
<link rel="shortcut icon" href="/assets/favicon.ico">

<style>
  /* ===== EXISTING STYLES (UNCHANGED) ===== */
  body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    text-align: center;
    margin:0;
    padding:40px 20px;
  }
  h2 { margin-bottom: 30px;}
  input, button {
    padding:10px 20px;
    font-size:16px;
    border-radius:6px;
    border:none;
    background-color:#3b82f6;
    color:white;
    cursor:pointer;
  }
  button:hover { background-color:#2563eb;}
  button:disabled { opacity:0.5; cursor:not-allowed;}
  canvas { border:2px solid #38bdf8; display:block; margin:10px auto;}
  .image-container {
    margin-top:20px;
    border:1px solid #3b82f6;
    padding:10px;
    display:inline-block;
  }
  .diff-container {
    display:flex;
    justify-content:center;
    gap:50px;
    margin-top:10px;
    flex-wrap:wrap;
  }
  .diff-box { text-align:center;}
  .label { font-size:14px; margin-top:5px; color:#e5e7eb;}
  .pixel-grid { display:flex; flex-wrap:wrap; justify-content:center;}
  .pixel-item { margin:5px; text-align:center;}
  .center-btn { display:block; margin:10px auto;}
  .progress { font-size:12px; color:#a5b4fc; margin-top:5px;}

  /* ===== ADDITIONAL UX STYLES ===== */

  /* Subtle background grid */
  body::before {
    content:"";
    position:fixed;
    inset:0;
    background-image:
      linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size:40px 40px;
    pointer-events:none;
  }

  .app-shell {
    max-width:1200px;
    margin:0 auto;
  }

  .top-panel {
    border:1px solid rgba(56,189,248,0.3);
    padding:20px;
    margin-bottom:30px;
    background:rgba(15,23,42,0.6);
  }

  .top-panel h1 {
    margin:0;
    font-size:26px;
    letter-spacing:1px;
  }

  .top-panel p {
    margin-top:10px;
    font-size:14px;
    color:#a5b4fc;
  }

  .workspace {
    border:1px solid rgba(59,130,246,0.4);
    padding:30px 20px;
    background:rgba(2,6,23,0.6);
  }

  .workspace-note {
    max-width:700px;
    margin:0 auto 30px;
    font-size:14px;
    color:#c7d2fe;
    line-height:1.6;
  }

  footer {
    margin-top:40px;
    font-size:12px;
    color:#94a3b8;
  }
</style>
</head>

<body>

<div class="app-shell">

  <!-- ðŸ”¹ LAB HEADER -->
  <div class="top-panel">
    <h1> IMAGE PERTURBATION </h1>
  </div>

  <!-- ðŸ”¹ MAIN WORKSPACE -->
  <div class="workspace">

    <div class="workspace-note">
      Upload one or more Image then click distortion to alter the pixels of Image.
      The distortion is designed to make subtle changes in image which reduce the reliability
      of input for AI analysis, while remaining difficult to detect through human visual perception.
      "Show difference" show each pixels original and distorted RGB and their colour number in below  
    </div>

    <!-- ===== ORIGINAL CONTENT (UNCHANGED) ===== -->
    <h2>Adversarial Pixel Perturbation</h2>
    <input type="file" id="upload" accept="image/*" multiple />
    <div id="allImages"></div>

  </div>

  <footer>
     No uploads are stored
  </footer>

</div>

<script>
/* ===== ORIGINAL SCRIPT (UNCHANGED) ===== */
const upload = document.getElementById("upload");
const allImages = document.getElementById("allImages");

const MAX_SIZE = 800;

let seed = Math.floor(Math.random()*1000000);
function seededRandom(){ let x=Math.sin(seed++)*10000; return x-Math.floor(x); }
function clamp(v){ return Math.max(0, Math.min(255, v)); }

upload.addEventListener("change", e=>{
  const files = e.target.files;
  allImages.innerHTML = '';

  Array.from(files).forEach((file, idx)=>{
    const img = new Image();
    img.onload = ()=>{

      const scale = Math.min(MAX_SIZE / img.width, MAX_SIZE / img.height, 1);
      const w = Math.round(img.width * scale);
      const h = Math.round(img.height * scale);

      const container = document.createElement("div");
      container.className = "image-container";

      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, w, h);

      const originalData = ctx.getImageData(0,0,w,h);
      let distortedData = ctx.createImageData(w,h);

      const progressText = document.createElement("div");
      progressText.className = "progress";

      const generateBtn = document.createElement("button");
      generateBtn.className = "center-btn";
      generateBtn.textContent = "Generate Distorted Image";

      const downloadBtn = document.createElement("button");
      downloadBtn.className = "center-btn";
      downloadBtn.textContent = "Download Distorted Image";
      downloadBtn.disabled = true;

      const seeDiffBtn = document.createElement("button");
      seeDiffBtn.className = "center-btn";
      seeDiffBtn.textContent = "Show Difference";
      seeDiffBtn.disabled = true;

      const diffContainer = document.createElement("div");
      diffContainer.className = "diff-container";
      diffContainer.style.display = "none";

      const origBox = document.createElement("div");
      origBox.className="diff-box";
      const origLabel = document.createElement("div");
      origLabel.className="label";
      origLabel.textContent="Original Pixels";
      const origPixelGrid = document.createElement("div");
      origPixelGrid.className="pixel-grid";
      origBox.append(origLabel, origPixelGrid);

      const distBox = document.createElement("div");
      distBox.className="diff-box";
      const distLabel = document.createElement("div");
      distLabel.className="label";
      distLabel.textContent="Distorted Pixels";
      const distPixelGrid = document.createElement("div");
      distPixelGrid.className="pixel-grid";
      distBox.append(distLabel, distPixelGrid);

      diffContainer.append(origBox, distBox);

      generateBtn.addEventListener("click", ()=>{
        generateBtn.disabled = true;
        const totalPixels = w*h;
        const indices = Array.from({length:totalPixels}, (_,i)=>i).sort(()=>Math.random()-0.5);
        let processed = 0;

        function batch(){
          const batchSize = Math.ceil(totalPixels/2400);
          for(let n=0;n<batchSize && processed<totalPixels;n++,processed++){
            const p = indices[processed]*4;
            distortedData.data[p]   = clamp(originalData.data[p]   + Math.floor(seededRandom()*7-3));
            distortedData.data[p+1] = clamp(originalData.data[p+1] + Math.floor(seededRandom()*7-3));
            distortedData.data[p+2] = clamp(originalData.data[p+2] + Math.floor(seededRandom()*7-3));
            distortedData.data[p+3] = 255;
          }
          ctx.putImageData(distortedData,0,0);
          progressText.textContent = `Generatingâ€¦ ${Math.floor((processed/totalPixels)*100)}%`;
          if(processed < totalPixels) requestAnimationFrame(batch);
          else {
            progressText.textContent = "Completed âœ”";
            downloadBtn.disabled = false;
            seeDiffBtn.disabled = false;
          }
        }
        batch();
      });

      downloadBtn.addEventListener("click", ()=>{
        const link = document.createElement("a");
        link.download = "distorted_"+idx+".png";
        link.href = canvas.toDataURL();
        link.click();
      });

      seeDiffBtn.addEventListener("click", ()=>{
        origPixelGrid.innerHTML='';
        distPixelGrid.innerHTML='';
        const totalPixels = w*h;
        const picks=[];
        while(picks.length<5){
          const r=Math.floor(Math.random()*totalPixels);
          if(!picks.includes(r)) picks.push(r);
        }

        picks.forEach(pixelIndex => {
  const i = pixelIndex * 4;
  const x = pixelIndex % w;
  const y = Math.floor(pixelIndex / w);

  const or = originalData.data[i];
  const og = originalData.data[i + 1];
  const ob = originalData.data[i + 2];

  const dr = distortedData.data[i];
  const dg = distortedData.data[i + 1];
  const db = distortedData.data[i + 2];

  const oHex = `#${or.toString(16).padStart(2,'0')}${og.toString(16).padStart(2,'0')}${ob.toString(16).padStart(2,'0')}`;
  const dHex = `#${dr.toString(16).padStart(2,'0')}${dg.toString(16).padStart(2,'0')}${db.toString(16).padStart(2,'0')}`;

  const oItem = document.createElement("div");
  oItem.className = "pixel-item";
  oItem.innerHTML = `
    Pixel (${x}, ${y})<br>
    RGB(${or}, ${og}, ${ob})<br>
    ${oHex}
    <div style="width:20px;height:20px;margin:5px auto;border:1px solid #999;background:${oHex}"></div>
  `;
  origPixelGrid.appendChild(oItem);

  const dItem = document.createElement("div");
  dItem.className = "pixel-item";
  dItem.innerHTML = `
    Pixel (${x}, ${y})<br>
    RGB(${dr}, ${dg}, ${db})<br>
    ${dHex}
    <div style="width:20px;height:20px;margin:5px auto;border:1px solid #999;background:${dHex}"></div>
  `;
  distPixelGrid.appendChild(dItem);
});

        diffContainer.style.display="flex";
      });

      container.append(
        canvas,
        progressText,
        generateBtn,
        downloadBtn,
        seeDiffBtn,
        diffContainer
      );

      allImages.appendChild(container);
    };
    img.src = URL.createObjectURL(file);
  });
});
</script>

</body>
</html>




